<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Deployment - MatchPlay</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #0f172a;
            color: #fff;
        }
        .card {
            background: #1e293b;
            border-radius: 12px;
            padding: 30px;
            margin: 20px 0;
            border: 2px solid #334155;
        }
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: monospace;
        }
        .success { background: #10b981; color: white; }
        .error { background: #ef4444; color: white; }
        .warning { background: #f59e0b; color: white; }
        h1 { color: #60a5fa; }
        h2 { color: #34d399; margin-top: 0; }
        code {
            background: #0f172a;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.9em;
        }
        .info {
            background: #1e40af;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #2563eb;
        }
        .timestamp {
            color: #94a3b8;
            font-size: 0.9em;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="card">
        <h1>üîç Teste de Deployment - MatchPlay</h1>
        <div class="timestamp">P√°gina gerada em: <span id="timestamp"></span></div>
    </div>

    <div class="card">
        <h2>Status das Vari√°veis de Ambiente</h2>
        <div id="env-status"></div>
    </div>

    <div class="card">
        <h2>Informa√ß√µes do Build</h2>
        <div id="build-info"></div>
    </div>

    <div class="card">
        <h2>Testes de Conectividade</h2>
        <button onclick="testSupabase()">Testar Conex√£o Supabase</button>
        <button onclick="testBackend()">Testar Backend API</button>
        <div id="test-results"></div>
    </div>

    <div class="info">
        <strong>‚ÑπÔ∏è Como usar:</strong><br>
        1. Se voc√™ v√™ "‚ùå VARI√ÅVEIS AUSENTES", precisa adicionar VITE_SUPABASE_URL e VITE_SUPABASE_ANON_KEY no painel de deployment<br>
        2. Se voc√™ v√™ "‚úÖ VARI√ÅVEIS CONFIGURADAS", o deployment est√° correto<br>
        3. Use os bot√µes acima para testar conectividade
    </div>

    <script type="module">
        // Exibir timestamp
        document.getElementById('timestamp').textContent = new Date().toLocaleString('pt-BR');

        // Verificar vari√°veis de ambiente
        const envStatus = document.getElementById('env-status');
        
        // Estas vari√°veis s√£o compiladas durante o build
        const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;
        const hasAnonKey = !!import.meta.env.VITE_SUPABASE_ANON_KEY;

        let statusHTML = '';

        if (supabaseUrl && hasAnonKey) {
            statusHTML = `
                <div class="status success">
                    ‚úÖ VARI√ÅVEIS CONFIGURADAS CORRETAMENTE
                </div>
                <div style="margin-top: 15px;">
                    <strong>Supabase URL:</strong><br>
                    <code>${supabaseUrl}</code>
                </div>
                <div style="margin-top: 15px;">
                    <strong>Anon Key:</strong> ‚úÖ Configurada (${import.meta.env.VITE_SUPABASE_ANON_KEY?.substring(0, 20)}...)
                </div>
            `;
        } else {
            statusHTML = `
                <div class="status error">
                    ‚ùå VARI√ÅVEIS AUSENTES - DEPLOYMENT N√ÉO VAI FUNCIONAR
                </div>
                <div style="margin-top: 15px;">
                    <strong>Problema detectado:</strong><br>
                    ${!supabaseUrl ? '‚ùå VITE_SUPABASE_URL n√£o configurada<br>' : ''}
                    ${!hasAnonKey ? '‚ùå VITE_SUPABASE_ANON_KEY n√£o configurada<br>' : ''}
                </div>
                <div class="status warning" style="margin-top: 15px;">
                    ‚ö†Ô∏è A√á√ÉO NECESS√ÅRIA:<br>
                    1. Abra: Deploy ‚Üí Configuration ‚Üí Environment Variables<br>
                    2. Adicione: VITE_SUPABASE_URL com sua URL do Supabase<br>
                    3. Adicione: VITE_SUPABASE_ANON_KEY com sua chave an√¥nima<br>
                    4. Clique em "Rebuild & Deploy"<br>
                    5. Aguarde 5 minutos e recarregue esta p√°gina
                </div>
            `;
        }

        envStatus.innerHTML = statusHTML;

        // Informa√ß√µes do build
        const buildInfo = document.getElementById('build-info');
        buildInfo.innerHTML = `
            <div style="margin: 10px 0;">
                <strong>Modo:</strong> ${import.meta.env.MODE}<br>
                <strong>Dev:</strong> ${import.meta.env.DEV ? 'Sim' : 'N√£o'}<br>
                <strong>Prod:</strong> ${import.meta.env.PROD ? 'Sim' : 'N√£o'}<br>
                <strong>Base URL:</strong> ${import.meta.env.BASE_URL}
            </div>
        `;

        // Fun√ß√£o de teste Supabase
        window.testSupabase = async () => {
            const results = document.getElementById('test-results');
            results.innerHTML = '<div class="status warning">üîÑ Testando conex√£o com Supabase...</div>';

            try {
                const { createClient } = await import('https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm');
                const supabase = createClient(
                    import.meta.env.VITE_SUPABASE_URL || '',
                    import.meta.env.VITE_SUPABASE_ANON_KEY || ''
                );

                const { data, error } = await supabase.from('plans').select('count');
                
                if (error) throw error;

                results.innerHTML = `
                    <div class="status success">
                        ‚úÖ CONEX√ÉO COM SUPABASE FUNCIONANDO!<br>
                        Deployment est√° configurado corretamente.
                    </div>
                `;
            } catch (error) {
                results.innerHTML = `
                    <div class="status error">
                        ‚ùå ERRO AO CONECTAR COM SUPABASE<br>
                        ${error.message}<br><br>
                        Verifique se as vari√°veis VITE_SUPABASE_URL e VITE_SUPABASE_ANON_KEY est√£o configuradas no deployment.
                    </div>
                `;
            }
        };

        // Fun√ß√£o de teste Backend
        window.testBackend = async () => {
            const results = document.getElementById('test-results');
            results.innerHTML = '<div class="status warning">üîÑ Testando conex√£o com backend...</div>';

            try {
                const response = await fetch('/health');
                const data = await response.json();

                if (response.ok) {
                    results.innerHTML = `
                        <div class="status success">
                            ‚úÖ BACKEND FUNCIONANDO!<br>
                            Status: ${data.status}
                        </div>
                    `;
                } else {
                    throw new Error('Backend retornou erro');
                }
            } catch (error) {
                results.innerHTML = `
                    <div class="status error">
                        ‚ùå ERRO AO CONECTAR COM BACKEND<br>
                        ${error.message}<br><br>
                        Verifique se o servidor est√° rodando.
                    </div>
                `;
            }
        };
    </script>
</body>
</html>
